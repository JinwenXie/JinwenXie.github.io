<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link rel="stylesheet" href="static/css/xjw-blog.css">
</head>
<body>
	<header>
		<div class="col">

		</div>
	</header>
	<section>
		<ul id="JxjwBlogList"></ul>
		<div class="clearfix"></div>
		<!-- - 博主正在努力更新 - -->
        <div class="loading loading-gif" id="Jloading"></div>
	</section>


	<script src="static/js/jquery.min.js"></script>
	<script src="static/js/posts.js"></script>
	<script>
		$(function(){
			let size = 6,
				start = 0,
				isScroll = true;

			function loadBlog(){
				let blogList = '';
				for( let i=start; i<size+start; i++ ){
					if(i<posts.data.length){
						blogList += `<li><a href="${posts.data[i].url}" target="_blank"><div class="art-img"><img src="${posts.data[i].articleImage}" alt=""></div><div class="art-info"><h4>${posts.data[i].title}</h4><p class="summary">${posts.data[i].summary}</p><p class="desc"><i class="author-img"><img src="${posts.data[i].authorImage}" /></i><i class="art-author">${posts.data[i].author}</i><i class="art-publish-time">${posts.data[i].date}</i></p></div></a></li>`;
					} else {
						$('#JxjwBlogList').append(blogList);
						$('#Jloading').removeClass('loading-gif').text('- 博主正在努力更新 -');
						isScroll = false;
						return false;
					}
				}
				if(start!=0){
					setTimeout(()=>{
						appendArt(blogList);
					},1000);
				} else {
					appendArt(blogList);
				}
			}
			function appendArt(blog){
				start = start + size;
				$('#Jloading').hide();
				$('#JxjwBlogList').append(blog);
				isScroll = true;
			}
			loadBlog();
			
			$(window).on('scroll',()=>{
				let scrollTop = $(window).scrollTop();
				if (scrollTop>=$(document).height()-$(window).height() ) {  
					if(isScroll) {
						$('#Jloading').show();
						isScroll = false;
						loadBlog();
					}
				}
			});
			
		});
	</script>
</body>
</html>